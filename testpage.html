<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style>
  /* These variables are now controlled by the Theme Modal */
  :root {
    --outer-bg: #4a6741;    
    --inner-bg: #0b2612;    
    --tile-bg: #1c3d25;     
    --text-primary: #75a478;
    --danger: #8b2e2e;
    --grid-gap: 8px;

    /* Class Type Colors */
    --c-starter: #78a2cc;
    --c-foundation: #a2cc78;
    --c-signature: #75a478; 
    --c-focus: #ccae78;
    --c-power: #cc7878;
    --c-advanced: #b378cc;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background-color: var(--outer-bg);
    font-family: 'Georgia', serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    min-height: 100vh;
  }

  .controls { 
    width: 100%; 
    max-width: 850px; 
    margin-bottom: 20px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
  }

  .selectors { display: flex; gap: 10px; }
  
  select.nav-select, .theme-btn {
    background: var(--inner-bg);
    color: var(--text-primary);
    border: 1px solid var(--text-primary);
    padding: 5px 10px;
    font-family: 'Georgia', serif;
    cursor: pointer;
  }

  .add-btn {
    background-color: var(--tile-bg);
    color: var(--text-primary);
    border: 1px solid var(--text-primary);
    padding: 10px 20px;
    cursor: pointer;
  }

  .calendar-container { width: 100%; max-width: 850px; background-color: var(--inner-bg); padding: 20px; }
  .header { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; color: var(--text-primary); }
  .header h1 { font-size: 2.2rem; font-weight: normal; text-transform: uppercase; }
  .line { height: 1px; background-color: var(--text-primary); flex-grow: 1; }

  .main-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--grid-gap); }
  .weekday-label { color: var(--text-primary); font-size: 1.8rem; text-align: center; padding: 10px 0; }

  .day { aspect-ratio: 1 / 1; position: relative; background-color: transparent; color: var(--text-primary); overflow: hidden; }
  .day.active { background-color: var(--tile-bg); padding: 5px; cursor: pointer; transition: 0.1s; border: 1px solid transparent; }
  .day.active:hover { transform: scale(1.02); z-index: 5; box-shadow: 0 0 10px rgba(0,0,0,0.5); border-color: var(--text-primary); }
  
  .date-num { position: absolute; top: 2px; right: 5px; font-size: 1.1rem; font-family: Arial, sans-serif; }
  .details { font-size: 0.6rem; font-family: Arial, sans-serif; line-height: 1.1; margin-top: 2px; }

  .box {
    border: 1px solid var(--text-primary);
    margin-top: 4px;
    padding: 2px;
    text-align: center;
    height: 60%;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  
  .box.Starter50 { border-color: var(--c-starter); color: var(--c-starter); }
  .box.Foundation50 { border-color: var(--c-foundation); color: var(--c-foundation); }
  .box.Focus50 { border-color: var(--c-focus); color: var(--c-focus); }
  .box.Power30 { border-color: var(--c-power); color: var(--c-power); }
  .box.Advanced50, .box.Advanced65 { border-color: var(--c-advanced); color: var(--c-advanced); }

  .title { font-weight: bold; font-size: 0.55rem; text-transform: uppercase; }
  .focus-text { font-size: 0.45rem; margin-top: 1px; line-height: 1; opacity: 0.9; }

  /* Modal Overlay */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; 
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    justify-content: center; 
    align-items: center;
    z-index: 1000;
  }

  .modal-content {
    background-color: var(--inner-bg);
    border: 2px solid var(--text-primary);
    padding: 25px;
    width: 480px;
    color: var(--text-primary);
  }

  .form-group { margin-bottom: 12px; display: flex; flex-direction: column; }
  .form-group label { font-size: 0.7rem; margin-bottom: 3px; text-transform: uppercase; opacity: 0.8; }
  .form-group input, .form-group select {
    background: var(--tile-bg);
    border: 1px solid var(--text-primary);
    color: var(--text-primary);
    padding: 8px;
  }

  .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
  .color-item { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
  .color-item input { width: 40px; height: 30px; border: 1px solid var(--text-primary); cursor: pointer; background: none; padding: 0; }

  .modal-actions { display: flex; gap: 10px; margin-top: 15px; }
  .modal-actions button { flex: 1; padding: 12px; cursor: pointer; border: 1px solid var(--text-primary); font-family: 'Georgia', serif; }
</style>
</head>
<body>

<div class="controls">
  <div class="selectors">
    <select id="view-month" class="nav-select" onchange="changeDate()"></select>
    <select id="view-year" class="nav-select" onchange="changeDate()"></select>
    <button class="theme-btn" onclick="openThemeModal()">ðŸŽ¨ Theme</button>
  </div>
  <button class="add-btn" onclick="openAddModal()">+ Add New Class</button>
</div>

<div class="calendar-container">
  <div class="header">
    <div class="line"></div>
    <h1 id="display-month">JANUARY</h1>
    <div class="line"></div>
  </div>
  <div id="calendar-grid" class="main-grid"></div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal-content">
    <h2 id="modalTitle" style="margin-bottom:15px; font-weight:normal;">Add New Class</h2>
    <form id="classForm">
      <input type="hidden" id="edit-id">
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div class="form-group"><label>Day</label><select id="m-day" required></select></div>
        <div class="form-group">
            <label>Class Type</label>
            <select id="m-name">
              <option value="Starter50">Starter50</option>
              <option value="Foundation50">Foundation50</option>
              <option value="Signature50" selected>Signature50</option>
              <option value="Focus50">Focus50</option>
              <option value="Power30">Power30</option>
              <option value="Advanced50">Advanced50</option>
              <option value="Advanced65">Advanced65</option>
            </select>
        </div>
      </div>
      <div class="form-group"><label>Instructor</label><input type="text" id="m-instructor" required></div>
      <div class="form-group">
        <label>Class Number (Auto-calculated)</label>
        <input type="text" id="m-class-num" readonly style="opacity: 0.6; cursor: not-allowed;" placeholder="Calculated on save...">
      </div>
      <div class="form-group"><label>Muscle Focuses</label><div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px;" id="focus-container"></div></div>
      <div style="display:flex; gap:10px;">
        <div class="form-group" style="flex:1;"><label>Start Time</label><input type="time" id="m-start" required></div>
        <div class="form-group" style="flex:1;"><label>End Time</label><input type="time" id="m-end" required></div>
      </div>
      <div class="modal-actions">
        <button type="button" style="background:#8b2e2e; color:white; border:none; display:none;" id="deleteBtn" onclick="deleteEntry()">Delete</button>
        <button type="button" style="background:transparent; color:var(--text-primary)" onclick="closeModal()">Cancel</button>
        <button type="submit" style="background:var(--text-primary); color:var(--inner-bg); font-weight:bold;">Save Class</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-overlay" id="themeModal">
    <div class="modal-content" style="width: 550px; max-height: 90vh; overflow-y: auto;">
      <h2 style="margin-bottom:15px; font-weight:normal;">Customize Theme</h2>
      
      <label style="font-size: 0.7rem; text-transform: uppercase; opacity: 0.8; display: block; margin-bottom: 10px;">Preset Themes</label>
      <div id="preset-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 25px;">
        </div>
  
      <label style="font-size: 0.7rem; text-transform: uppercase; opacity: 0.8; display: block; margin-bottom: 10px;">Custom Colors</label>
      <div class="color-grid">
        <div class="color-item"><input type="color" id="p-outer" oninput="uiTheme('--outer-bg', this.value)"><label>Outer BG</label></div>
        <div class="color-item"><input type="color" id="p-inner" oninput="uiTheme('--inner-bg', this.value)"><label>Inner BG</label></div>
        <div class="color-item"><input type="color" id="p-tile" oninput="uiTheme('--tile-bg', this.value)"><label>Empty Tile</label></div>
        <div class="color-item"><input type="color" id="p-text" oninput="uiTheme('--text-primary', this.value)"><label>Text/Accents</label></div>
        
        <div style="grid-column: 1 / -1; height: 1px; background: var(--text-primary); opacity: 0.3; margin: 10px 0;"></div>
        
        <div class="color-item"><input type="color" id="p-starter" oninput="uiTheme('--c-starter', this.value)"><label>Starter</label></div>
        <div class="color-item"><input type="color" id="p-foundation" oninput="uiTheme('--c-foundation', this.value)"><label>Foundation</label></div>
        <div class="color-item"><input type="color" id="p-signature" oninput="uiTheme('--c-signature', this.value)"><label>Signature</label></div>
        <div class="color-item"><input type="color" id="p-focus" oninput="uiTheme('--c-focus', this.value)"><label>Focus</label></div>
        <div class="color-item"><input type="color" id="p-power" oninput="uiTheme('--c-power', this.value)"><label>Power</label></div>
        <div class="color-item"><input type="color" id="p-adv" oninput="uiTheme('--c-advanced', this.value)"><label>Advanced</label></div>
      </div>
  
      <div class="modal-actions">
        <button type="button" style="background:var(--text-primary); color:var(--inner-bg); font-weight:bold;" onclick="closeThemeModal()">Done</button>
      </div>
    </div>
  </div>
  
  <script>
    // 1. Theme Library
    const THEMES = {
      "Signature": { outer: "#4a6741", inner: "#0b2612", tile: "#1c3d25", text: "#75a478" },
      "Midnight":  { outer: "#1a1a1a", inner: "#000000", tile: "#262626", text: "#ffffff" },
      "Oceanic":   { outer: "#1e3a5f", inner: "#0d1b2a", tile: "#1b263b", text: "#a2d2ff" },
      "Espresso":  { outer: "#3d2b1f", inner: "#1a0f0a", tile: "#2b1d16", text: "#d4a373" },
      "Slate":     { outer: "#4a5568", inner: "#1a202c", tile: "#2d3748", text: "#a0aec0" },
      "Plum":      { outer: "#4a2c4a", inner: "#2d162d", tile: "#3d1f3d", text: "#d6bcfa" },
      "Crimson":   { outer: "#63171b", inner: "#2d0a0c", tile: "#441013", text: "#feb2b2" },
      "Forest":    { outer: "#2d4a22", inner: "#14260f", tile: "#1e3617", text: "#9ae6b4" },
      "Desert":    { outer: "#744210", inner: "#2d1a05", tile: "#432808", text: "#f6e05e" },
      "Charcoal":  { outer: "#2d3748", inner: "#171923", tile: "#2d3748", text: "#cbd5e0" },
      "Rose":      { outer: "#702459", inner: "#320923", tile: "#4d163d", text: "#fbb6ce" },
      "Classic":   { outer: "#2c5282", inner: "#1a365d", tile: "#2a4365", text: "#ebf8ff" }
    };
  
    // 2. Preset logic
    function applyPreset(name) {
      const t = THEMES[name];
      uiTheme('--outer-bg', t.outer);
      uiTheme('--inner-bg', t.inner);
      uiTheme('--tile-bg', t.tile);
      uiTheme('--text-primary', t.text);
      
      // Sync pickers
      document.getElementById('p-outer').value = t.outer;
      document.getElementById('p-inner').value = t.inner;
      document.getElementById('p-tile').value = t.tile;
      document.getElementById('p-text').value = t.text;
    }
  
    // Add this to your init() function
    function loadPresets() {
      const container = document.getElementById('preset-grid');
      Object.keys(THEMES).forEach(name => {
        const theme = THEMES[name];
        const btn = document.createElement('div');
        btn.style = `cursor:pointer; border:1px solid ${theme.text}; background:${theme.outer}; padding:8px; text-align:center; font-size:0.6rem; color:${theme.text};`;
        btn.innerText = name;
        btn.onclick = () => applyPreset(name);
        container.appendChild(btn);
      });
    }
  
    // Update existing uiTheme to keep pickers in sync when manually used
    function uiTheme(variable, val) { 
      document.documentElement.style.setProperty(variable, val);
    }
  
    // Update init to call loadPresets
    const originalInit = init;
    init = function() {
      originalInit();
      loadPresets();
      // Set initial picker values to match CSS defaults
      document.getElementById('p-outer').value = "#4a6741";
      document.getElementById('p-inner').value = "#0b2612";
      document.getElementById('p-tile').value = "#1c3d25";
      document.getElementById('p-text').value = "#75a478";
      document.getElementById('p-starter').value = "#78a2cc";
      document.getElementById('p-foundation').value = "#a2cc78";
      document.getElementById('p-signature').value = "#75a478";
      document.getElementById('p-focus').value = "#ccae78";
      document.getElementById('p-power').value = "#cc7878";
      document.getElementById('p-adv').value = "#b378cc";
    };

  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let classData = [];
  const CLASS_CONFIG = {
  "Starter50": 50,
  "Foundation50": 50,
  "Signature50": 50,
  "Focus50": 50,
  "Power30": 30,
  "Advanced50": 50,
  "Advanced65": 65
};

  const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

  function uiTheme(variable, val) { document.documentElement.style.setProperty(variable, val); }
  function openThemeModal() { document.getElementById('themeModal').style.display = 'flex'; }
  function closeThemeModal() { document.getElementById('themeModal').style.display = 'none'; }

  function init() {
    const monthSelect = document.getElementById('view-month');
    const yearSelect = document.getElementById('view-year');
    months.forEach((m, i) => monthSelect.insertAdjacentHTML('beforeend', `<option value="${i}" ${i === currentMonth ? 'selected' : ''}>${m}</option>`));
    for(let y = currentYear - 1; y <= currentYear + 3; y++) yearSelect.insertAdjacentHTML('beforeend', `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`);
    
    const focusOptions = `<option value="">None</option><optgroup label="Lower Body"><option>Center Glutes</option><option>Outer Glutes</option><option>Inner Thighs</option><option>Hamstrings</option><option>Leg Wrap</option></optgroup><optgroup label="Upper Body"><option>Back</option><option>Shoulders</option><option>Biceps</option><option>Triceps</option><option>Chest</option><option>Arm Wrap</option></optgroup><optgroup label="Core"><option>Core & Obliques</option><option>Core</option><option>Obliques</option></optgroup>`;
    document.getElementById('focus-container').innerHTML = `<select id="f1">${focusOptions}</select><select id="f2">${focusOptions}</select><select id="f3">${focusOptions}</select>`;
    // Add these to your initialization logic
document.getElementById('m-start').addEventListener('input', autoFillEndTime);
document.getElementById('m-name').addEventListener('change', autoFillEndTime);
    changeDate(); 
  }

  function changeDate() {
    currentMonth = parseInt(document.getElementById('view-month').value);
    currentYear = parseInt(document.getElementById('view-year').value);
    document.getElementById('display-month').innerText = months[currentMonth];
    renderCalendar();
  }

  function renderCalendar() {
    const grid = document.getElementById('calendar-grid');
    grid.innerHTML = '';
    ['S', 'M', 'T', 'W', 'T', 'F', 'S'].forEach(l => grid.insertAdjacentHTML('beforeend', `<div class="weekday-label">${l}</div>`));
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const mDaySelect = document.getElementById('m-day');
    mDaySelect.innerHTML = '';
    for(let i=1; i<=daysInMonth; i++) mDaySelect.insertAdjacentHTML('beforeend', `<option value="${i}">${i}</option>`);
    for (let i = 0; i < firstDay; i++) grid.insertAdjacentHTML('beforeend', `<div class="day"></div>`);
    for (let d = 1; d <= daysInMonth; d++) {
      const schedule = classData.find(item => item.day === d && item.month === currentMonth && item.year === currentYear);
      let content = `<div class="date-num">${d}</div>`;
      if (schedule) {
        const focuses = [schedule.focus1, schedule.focus2, schedule.focus3].filter(f => f).join(' & ');
  
  // Logic to only show the number if it's 10, 20, 30, etc.
  const showNumber = (schedule.classCount % 10 === 0) ? 
    `<div style="position:absolute; bottom:2px; right:5px; font-size:10px; font-weight:bold; color:var(--text-primary); opacity:0.8;">#${schedule.classCount}</div>` : '';

  content += `
    <div class="details">${schedule.instructor}<br>${formatTime(schedule.startTime)}</div>
    <div class="box ${schedule.className}">
      <div class="title">${schedule.className}</div>
      <div class="focus-text">${focuses}</div>
      ${showNumber}
    </div>`;
      }
      grid.insertAdjacentHTML('beforeend', `<div class="day active" onclick="${schedule ? `openEditModal(${schedule.id})` : `openAddModal(${d})`}">${content}</div>`);
    }
  }

  function openAddModal(d) {
    document.getElementById('classForm').reset();
    document.getElementById('edit-id').value = "";
    document.getElementById('deleteBtn').style.display = "none";
    if (d) document.getElementById('m-day').value = d;
    document.getElementById('modalOverlay').style.display = 'flex';
  }

  function openEditModal(id) {
    const item = classData.find(i => i.id == id);
    document.getElementById('deleteBtn').style.display = "block";
    document.getElementById('edit-id').value = item.id;
    document.getElementById('m-day').value = item.day;
    document.getElementById('m-instructor').value = item.instructor;
    document.getElementById('m-name').value = item.className;
    document.getElementById('m-start').value = item.startTime;
    document.getElementById('m-end').value = item.endTime;
    document.getElementById('f1').value = item.focus1;
    document.getElementById('f2').value = item.focus2;
    document.getElementById('f3').value = item.focus3;
    document.getElementById('modalOverlay').style.display = 'flex';
  }

  function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
  function formatTime(t) { let [h, m] = t.split(':'); let ampm = h >= 12 ? 'pm' : 'am'; h = h % 12 || 12; return `${h}:${m} ${ampm}`; }

  // Update your Form Submit to trigger the recalculation
document.getElementById('classForm').onsubmit = function(e) {
  e.preventDefault();
  const id = document.getElementById('edit-id').value;
  const entry = {
    id: id ? parseInt(id) : Date.now(),
    day: parseInt(document.getElementById('m-day').value),
    month: currentMonth, 
    year: currentYear,
    instructor: document.getElementById('m-instructor').value,
    startTime: document.getElementById('m-start').value,
    endTime: document.getElementById('m-end').value,
    className: document.getElementById('m-name').value,
    focus1: document.getElementById('f1').value,
    focus2: document.getElementById('f2').value,
    focus3: document.getElementById('f3').value
    // classCount will be added by recalculate function
  };

  if (id) {
    classData = classData.map(item => item.id == id ? entry : item);
  } else {
    classData.push(entry);
  }

  recalculateClassCounts(); // Run the calculation
  closeModal();
  renderCalendar();
};

  function recalculateClassCounts() {
  // 1. Sort all classes globally by Year, then Month, then Day, then Start Time
  classData.sort((a, b) => {
    if (a.year !== b.year) return a.year - b.year;
    if (a.month !== b.month) return a.month - b.month;
    if (a.day !== b.day) return a.day - b.day;
    return a.startTime.localeCompare(b.startTime);
  });

  // 2. Assign the chronological count
  classData.forEach((item, index) => {
    item.classCount = index + 1;
  });
}



// Also update deleteEntry to recalculate
function deleteEntry() {
  classData = classData.filter(i => i.id != document.getElementById('edit-id').value);
  recalculateClassCounts(); // Run calculation so numbers shift up
  closeModal();
  renderCalendar();
}
  function autoFillEndTime() {
  const startTimeVal = document.getElementById('m-start').value;
  const className = document.getElementById('m-name').value;

  // Look up duration from our map. Default to 50 if not found.
  const durationMinutes = CLASS_CONFIG[className] || 50;

  if (!startTimeVal) return;

  // Split start time (HH:mm)
  const [hours, minutes] = startTimeVal.split(':').map(Number);
  
  // Create a date object to perform the math
  const date = new Date();
  date.setHours(hours);
  date.setMinutes(minutes + durationMinutes);

  // Format back to 24hr string for the time picker
  const endHours = String(date.getHours()).padStart(2, '0');
  const endMinutes = String(date.getMinutes()).padStart(2, '0');
  
  document.getElementById('m-end').value = `${endHours}:${endMinutes}`;
}

  init();
</script>
</body>
</html>